"use strict";(self.webpackChunkoc_studio_docs=self.webpackChunkoc_studio_docs||[]).push([[4044],{8537:function(e,n,s){s.r(n),s.d(n,{assets:function(){return l},contentTitle:function(){return r},default:function(){return h},frontMatter:function(){return a},metadata:function(){return o},toc:function(){return c}});var t=s(5893),i=s(1151);const a={title:"Conditions",sidebar_title:"Conditions"},r=void 0,o={id:"dialog-manager/conditions",title:"Conditions",description:"What are conditions?",source:"@site/docs/dialog-manager/conditions.md",sourceDirName:"dialog-manager",slug:"/dialog-manager/conditions",permalink:"/docs/dialog-manager/conditions",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Conditions",sidebar_title:"Conditions"},sidebar:"docs",previous:{title:"Dialog Manager",permalink:"/docs/dialog-manager/overview"},next:{title:"Intents",permalink:"/docs/model/intents"}},l={},c=[{value:"What are conditions?",id:"what-are-conditions",level:2},{value:"Common Examples",id:"common-examples",level:2},{value:"Disabling a Response",id:"disabling-a-response",level:3},{value:"Slot Filling",id:"slot-filling",level:3},{value:"New vs Returning User",id:"new-vs-returning-user",level:3},{value:"Restricted Content",id:"restricted-content",level:3},{value:"Notation",id:"notation",level:2},{value:"Required condition and one of two possibilities",id:"required-condition-and-one-of-two-possibilities",level:3},{value:"Provided Macros",id:"provided-macros",level:2},{value:"What are conditional macros?",id:"what-are-conditional-macros",level:3},{value:"Slots",id:"slots",level:3},{value:"Active Within",id:"active-within",level:3},{value:"Fits Schedule",id:"fits-schedule",level:3},{value:"System",id:"system",level:3},{value:"Request Specific",id:"request-specific",level:3},{value:"Request Type",id:"request-type",level:3},{value:"Request IDs",id:"request-ids",level:3},{value:"Accessing the Request &amp; Context Directly",id:"accessing-the-request--context-directly",level:2},{value:"Syntax &amp; Evaluation",id:"syntax--evaluation",level:2},{value:"On the object model",id:"on-the-object-model",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"what-are-conditions",children:"What are conditions?"}),"\n",(0,t.jsx)(n.p,{children:"Conditions are logical statements that allow you to control the dialog manager by telling it when to play certain content or when to apply a particular redirect or forward. For example, you can define unique greetings depending on the time of day or if the user is new vs returning."}),"\n",(0,t.jsx)(n.h2,{id:"common-examples",children:"Common Examples"}),"\n",(0,t.jsx)(n.h3,{id:"disabling-a-response",children:"Disabling a Response"}),"\n",(0,t.jsxs)(n.p,{children:["You can completely disable a response by settting the condition to ",(0,t.jsx)(n.code,{children:"false"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"false;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"slot-filling",children:"Slot Filling"}),"\n",(0,t.jsx)(n.p,{children:"You want to provide a specific response a particular slot is not provided to then prompt for the slot value."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'slotDoesNotExist("required_slot_name");\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"important",children:(0,t.jsx)(n.p,{children:"The name must match the name of the slot exactly, it is case sensitive."})}),"\n",(0,t.jsx)(n.h3,{id:"new-vs-returning-user",children:"New vs Returning User"}),"\n",(0,t.jsx)(n.p,{children:"You want to provide a specific welcome message, by using a segment, depending on when the user was last seen."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'activeWithin(2, "months");\n'})}),"\n",(0,t.jsx)(n.p,{children:"This treats all users, if they have been active within two months as returning users. User's not seen within two months or ever, can be given a new user response."}),"\n",(0,t.jsx)(n.h3,{id:"restricted-content",children:"Restricted Content"}),"\n",(0,t.jsx)(n.p,{children:"You want redirect a user to another handler depending on if they have linked their account (logged in) or not."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"!hasLinkedAccount();\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"important",children:(0,t.jsxs)(n.p,{children:["In the above example, the ",(0,t.jsx)(n.code,{children:"!"})," is the ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_NOT",children:"logical not operater"})," which negates the value (i.e. turns false to true and true to false). If the user does not have a linked account the ",(0,t.jsx)(n.code,{children:"hasLinkedAccount()"})," macros will return ",(0,t.jsx)(n.code,{children:"false"}),", which when you add ",(0,t.jsx)(n.code,{children:"!"})," it then returns ",(0,t.jsx)(n.code,{children:"true"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"notation",children:"Notation"}),"\n",(0,t.jsxs)(n.p,{children:["The statements respect JavaScript logical operators such as ",(0,t.jsx)(n.code,{children:"true"}),", ",(0,t.jsx)(n.code,{children:"false"}),", ",(0,t.jsx)(n.code,{children:"&&"}),", ",(0,t.jsx)(n.code,{children:"||"}),", and ",(0,t.jsx)(n.code,{children:"!"})," as well as comparison operators ",(0,t.jsx)(n.code,{children:"==="}),", ",(0,t.jsx)(n.code,{children:"!=="}),", ",(0,t.jsx)(n.code,{children:">"}),", ",(0,t.jsx)(n.code,{children:"<"}),", ",(0,t.jsx)(n.code,{children:"<="})," and ",(0,t.jsx)(n.code,{children:">="}),". You can also apply order of operations with ",(0,t.jsx)(n.code,{children:"()"})," around a statement."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Valid Conditional Statements"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"true; // return true\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"true && false; // returns false\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"false || 3 === 3; // returns true\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Some common macros are also provided to make common tasks like slot comparisons or date comparisons easier. For more information see ",(0,t.jsx)(n.a,{href:"#provided-macros",children:"Provided Macros"})]}),"\n",(0,t.jsx)(n.h3,{id:"required-condition-and-one-of-two-possibilities",children:"Required condition and one of two possibilities"}),"\n",(0,t.jsx)(n.p,{children:"You may need to set one required condition with two other possibilities. All logical JavaScript operators are supported so the pattern is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"REQUIRED && (OPTION_1 || OPTION_2);\n"})}),"\n",(0,t.jsx)(n.p,{children:"To then translate this to an actual use case, you have scheduled content that can be accessed through two possible slot values, like a sporting event."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'fitsSchedule("2019-09-11T18:40", "YYYY-MM-DDTmm:ss", 210, "minutes") && ( slotEquals("team", "one") || slotEquals("team", "two")\n'})}),"\n",(0,t.jsx)(n.h2,{id:"provided-macros",children:"Provided Macros"}),"\n",(0,t.jsx)(n.h3,{id:"what-are-conditional-macros",children:"What are conditional macros?"}),"\n",(0,t.jsx)(n.p,{children:"Conditional macros are predefined functions that perform a specific task. The functions they perform can be complicated to repeatedly construct so they make it easier to build and less error prone."}),"\n",(0,t.jsx)(n.h3,{id:"slots",children:"Slots"}),"\n",(0,t.jsx)(n.p,{children:"You can check if a slot exists:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"hasSlot(name: string);\n"})}),"\n",(0,t.jsx)(n.p,{children:"or"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"slotExists(name: string);\n"})}),"\n",(0,t.jsx)(n.p,{children:"Where name is the name of the slot and both will return true if the slot exists and does not equal an empty string."}),"\n",(0,t.jsx)(n.p,{children:"You can check is a slots value equals a particular value:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"slotEquals(name: string, value: string);\n"})}),"\n",(0,t.jsx)(n.p,{children:'For example, you are expecting slot named "university" to equal "University of Virginia"'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'slotEquals("university", "University of Virginia");\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"important",children:(0,t.jsxs)(n.p,{children:["The value you enter ",(0,t.jsx)(n.strong,{children:"must"})," but the primary entity value, not a synonym."]})}),"\n",(0,t.jsx)(n.h3,{id:"active-within",children:"Active Within"}),"\n",(0,t.jsx)(n.p,{children:"The user has been active within the provided amount. This can be used to provide a response to a user that has used the application before but are coming back after some time and need a refresher."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"activeWithin(amount: number, format: DurationFormat)\n"})}),"\n",(0,t.jsx)(n.p,{children:"For example, the user is active within the last five days."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'activeWithin(5, "days");\n'})}),"\n",(0,t.jsx)(n.p,{children:'The available formats are "years", "quarters", "months", "weeks", "days", "hours", "minutes", "seconds", "milliseconds".'}),"\n",(0,t.jsx)(n.h3,{id:"fits-schedule",children:"Fits Schedule"}),"\n",(0,t.jsx)(n.p,{children:"The current time for the user fits within the provided schedule."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"fitsSchedule(start: string, startFormat: string, durationAmount: number, durationFormat: string, timeZone?: string)\n"})}),"\n",(0,t.jsx)(n.p,{children:"For example, for a schedule that starts on September 11, 2019 at midnight and runs for five days."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'fitsSchedule("2019-09-11T00:00", "YYYY-MM-DDTmm:ss", 5, "days");\n'})}),"\n",(0,t.jsx)(n.h3,{id:"system",children:"System"}),"\n",(0,t.jsx)(n.p,{children:"To check if the user has linked their account, i.e. logged in."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"hasLinkedAccount();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"request-specific",children:"Request Specific"}),"\n",(0,t.jsx)(n.p,{children:"To check the platform:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"isPlatform(platform: string)\n"})}),"\n",(0,t.jsx)(n.p,{children:"To check if the user is on a particular web page:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"onWebPage(pattern: string)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Primarily for chat widgets installed on websites, this will check the current page they are on against a provided pattern.  For example if you use:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'onWebPage("xapp.ai")\n'})}),"\n",(0,t.jsxs)(n.p,{children:["It will match to any page with domain ",(0,t.jsx)(n.code,{children:"xapp.ai"})," such as ",(0,t.jsx)(n.code,{children:"xapp.ai/about-us"})," & ",(0,t.jsx)(n.code,{children:"xapp.ai"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"You can narrow it by providing a path:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'onWebPage("xapp.ai/about-us")\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Which will only match to ",(0,t.jsx)(n.code,{children:"xapp.ai/about-us"})," and any subdirectories."]}),"\n",(0,t.jsx)(n.h3,{id:"request-type",children:"Request Type"}),"\n",(0,t.jsx)(n.p,{children:"The following are available to check the type of request:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"isIntentRequest();\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"isLaunchRequest();\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"isInputUnknownRequest();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"request-ids",children:"Request IDs"}),"\n",(0,t.jsx)(n.p,{children:"To match based on the ID of the request:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"isRequestID(id: string | string[])\n"})}),"\n",(0,t.jsx)(n.p,{children:"You can either provide a single string or an array of strings."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'isRequestID("LaunchRequest");\n'})}),"\n",(0,t.jsx)(n.p,{children:"or"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'isRequestID(["FooIntent", "BarIntent"]);\n'})}),"\n",(0,t.jsx)(n.p,{children:"which will return true for either of the two IDs provided."}),"\n",(0,t.jsx)(n.h2,{id:"accessing-the-request--context-directly",children:"Accessing the Request & Context Directly"}),"\n",(0,t.jsx)(n.p,{children:"You can add conditional statements beyond what is provided with the macros by accessing the context or request directly.  The request has information about the specific request from the user and the context has information about the user that is both session specific and historical.  Let's look at some examples:"}),"\n",(0,t.jsx)(n.p,{children:"Accessing the session storage:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'"${$.context.storage.sessionStore.data.some_boolean_value}" === "true"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Accessing information on the request:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'"${$.request.rawQuery}".startsWith("no")\n'})}),"\n",(0,t.jsx)(n.h2,{id:"syntax--evaluation",children:"Syntax & Evaluation"}),"\n",(0,t.jsxs)(n.p,{children:["The syntax is a mix of JavaScript's ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals",children:"template literals"})," and JSONPath.  The outer ",(0,t.jsx)(n.code,{children:"${}"})," is the template literal and the internal ",(0,t.jsx)(n.code,{children:"$.request.rawQuery"})," is ",(0,t.jsx)(n.a,{href:"https://goessner.net/articles/JsonPath/",children:"JSONPath"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"First the JSONPath is evaluated and then the template literal is evaluated.  For the JSONPath evaluation, an object with the request and context are passed in:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "request": {...the request },\n    "context": {...the context }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The starting ",(0,t.jsx)(n.code,{children:"$"})," means the root element.  Then you can follow through from the root to access the context ",(0,t.jsx)(n.code,{children:"$.context."})," and on the request ",(0,t.jsx)(n.code,{children:"$.request."})]}),"\n",(0,t.jsx)(n.h2,{id:"on-the-object-model",children:"On the object model"}),"\n",(0,t.jsxs)(n.p,{children:["When modifying the object model directly through JSON, the key on paths and responses is ",(0,t.jsx)(n.code,{children:"conditions"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\n"conditions": "\\"${$.request.platform}\\" === \\"dialogflow-telephony\\""\n\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"important",children:(0,t.jsx)(n.p,{children:"You will need to escape quotes to keep the JSON valid, see the example above."})})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1151:function(e,n,s){s.d(n,{Z:function(){return o},a:function(){return r}});var t=s(7294);const i={},a=t.createContext(i);function r(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);