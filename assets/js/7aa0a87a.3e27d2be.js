"use strict";(self.webpackChunkoc_studio_docs=self.webpackChunkoc_studio_docs||[]).push([[9014],{7036:function(e,n,t){t.r(n),t.d(n,{assets:function(){return l},contentTitle:function(){return r},default:function(){return p},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return a}});var s=t(5893),o=t(1151);const i={title:"Compiling Templated Responses",sidebar_label:"Templated Responses"},r=void 0,c={id:"development/compiling-templated-responses",title:"Compiling Templated Responses",description:"With a custom handler that is gathering information from the user and also pulling information from different data sources, instead of dynamically building the response you may instead want to leverage templated responses.",source:"@site/docs/development/compiling-templated-responses.md",sourceDirName:"development",slug:"/development/compiling-templated-responses",permalink:"/docs/development/compiling-templated-responses",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Compiling Templated Responses",sidebar_label:"Templated Responses"},sidebar:"docs",previous:{title:"Storage",permalink:"/docs/development/storage"},next:{title:"Tokens",permalink:"/docs/development/tokens"}},l={},a=[{value:"Get Response",id:"get-response",level:2},{value:"With Additional Context",id:"with-additional-context",level:3},{value:"With Custom Macros",id:"with-custom-macros",level:3},{value:"Compile Response",id:"compile-response",level:2},{value:"With Additional Context",id:"with-additional-context-1",level:3},{value:"With Custom Macros",id:"with-custom-macros-1",level:3},{value:"With determineResponse",id:"with-determineresponse",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["With a ",(0,s.jsx)(n.a,{href:"/docs/development/custom-handlers",children:"custom handler"})," that is gathering information from the user and also pulling information from different data sources, instead of dynamically building the response you may instead want to leverage ",(0,s.jsx)(n.a,{href:"/docs/content/responses#templated-responses",children:"templated responses"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["The primary methods to accomplish this is either ",(0,s.jsx)(n.code,{children:"getResponse"})," or ",(0,s.jsx)(n.code,{children:"compileResponse"})," in a custom handler."]}),"\n",(0,s.jsx)(n.h2,{id:"get-response",children:"Get Response"}),"\n",(0,s.jsxs)(n.p,{children:["For situations where you have responses defined within studio, you can leverage ",(0,s.jsx)(n.code,{children:"getResponse"})," to not just determine the right response but also then compile it for you.  It uses ",(0,s.jsx)(n.code,{children:"compileResponse"})," within it to do the actual compilation.  Feel free to checkout the ",(0,s.jsx)(n.a,{href:"https://github.com/stentorium/stentor/blob/master/packages/stentor-response/src/getResponse.ts%5B",children:"source"})," and ",(0,s.jsx)(n.a,{href:"https://github.com/stentorium/stentor/blob/master/packages/stentor-response/src/__test__/getResponse.test.ts",children:"tests"})," for this method to get a better understanding."]}),"\n",(0,s.jsx)(n.h3,{id:"with-additional-context",children:"With Additional Context"}),"\n",(0,s.jsx)(n.p,{children:"You can also pass in additional context that the compiler will take into consideration.  This can be information from APIs or other sources."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'const response = getResponse(this.content, request, context, { user_name: "John" });\ncontext.response.respond(response);\n'})}),"\n",(0,s.jsx)(n.p,{children:"This will take a response like:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Hello ${user_name}\n"})}),"\n",(0,s.jsx)(n.p,{children:"and compile it as:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Hello John!\n"})}),"\n",(0,s.jsx)(n.h3,{id:"with-custom-macros",children:"With Custom Macros"}),"\n",(0,s.jsxs)(n.p,{children:["With this method, you can leverage the ",(0,s.jsx)(n.a,{href:"/docs/content/responses#default-macros",children:"default macros"})," but you can also inject your own custom macros."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'// Turns 2021-04-22 style dates to 2021/04/22\nconst date: (input: string) => string = (input: string) => {\n    return input.replace(/-/g, "/")\n}\n\nconst response = getResponse(this.content, request, context, {\n    user_name: "John",\n    date: {\n        name: "date",\n        value: "2021-09-11"\n    }\n}, { date });\n\ncontext.response.respond(response);\n'})}),"\n",(0,s.jsx)(n.p,{children:"This will turn a response with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Delivery on the ${date('${date}')}, is that ok ${capitalize('${user_name}')}?\n"})}),"\n",(0,s.jsx)(n.p,{children:"into"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Delivery on the 2021/09/11, is that ok John?\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Notice how it changed the ",(0,s.jsx)(n.code,{children:"-"})," into ",(0,s.jsx)(n.code,{children:"/"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"compile-response",children:"Compile Response"}),"\n",(0,s.jsxs)(n.p,{children:["Compile response takes a response and looks for templates to then replace with values found in the request, context, or additional context.  Feel free to checkout the ",(0,s.jsx)(n.a,{href:"https://github.com/stentorium/stentor/blob/master/packages/stentor-response/src/compileResponse.ts",children:"source"})," of the method and look at the ",(0,s.jsx)(n.a,{href:"https://github.com/stentorium/stentor/blob/master/packages/stentor-response/src/__test__/compileResponse.test.ts",children:"tests"})," for examples of what it can do."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { compileResponse } from "stentor";\n\nconst compiled = compileResponse(response, request, context);\ncontext.response.respond(compiled);\n'})}),"\n",(0,s.jsx)(n.p,{children:"In the example above, the method will compile any values you have on session storage or found in slots."}),"\n",(0,s.jsx)(n.h3,{id:"with-additional-context-1",children:"With Additional Context"}),"\n",(0,s.jsx)(n.p,{children:"You can also pass in additional context that the compiler will take into consideration."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'const compiled = compileResponse(response, request, context, { user_name: "John" });\ncontext.response.respond(compiled);\n'})}),"\n",(0,s.jsx)(n.p,{children:"Which can be references the same way in the templated response:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Hello ${user_name}!\n"})}),"\n",(0,s.jsxs)(n.p,{children:["will be compiled to ",(0,s.jsx)(n.code,{children:"Hello John!"})]}),"\n",(0,s.jsx)(n.h3,{id:"with-custom-macros-1",children:"With Custom Macros"}),"\n",(0,s.jsxs)(n.p,{children:["With this method, you can leverage the ",(0,s.jsx)(n.a,{href:"/docs/content/responses#default-macros",children:"default macros"})," but you can also inject your own custom macros."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'// Turns 2021-04-22 style dates to 2021/04/22\nconst date: (input: string) => string = (input: string) => {\n    return input.replace(/-/g, "/")\n}\n\nconst compiled = compileResponse(response, request, context, {\n    user_name: "John",\n    date: {\n        name: "date",\n        value: "2021-09-11"\n    }\n}, { date });\ncontext.response.respond(compiled);\n'})}),"\n",(0,s.jsx)(n.p,{children:"This will turn a response with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Delivery on the ${date('${date}')}, is that ok ${capitalize('${user_name}')}?\n"})}),"\n",(0,s.jsx)(n.p,{children:"into"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Delivery on the 2021/09/11, is that ok John?\n"})}),"\n",(0,s.jsx)(n.h3,{id:"with-determineresponse",children:"With determineResponse"}),"\n",(0,s.jsx)(n.p,{children:"It is often helpful to have the responses defined in Studio with conditionals set to allow the dialog manager to best select the response for you.  From there, you can then programmatically modify the response before then passing it to compile response."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'\nimport { keyFromRequest, findValueForKey,  determineResponse, getResponse } from "stentor";\n\nconst key = keyFromRequest(request);\nconst responses = findValueForKey(key, this.content);\nconst response = determineResponse(responses, request, context);\n// Modify the response as you like before compilation\nconst compiled = compileResponse(response, request, context);\n'})})]})}function p(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:function(e,n,t){t.d(n,{Z:function(){return c},a:function(){return r}});var s=t(7294);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);